#!/bin/bash

cd /etc/swift

rm -f *.builder *.ring.gz backups/*.builder backups/*.ring.gz

swift-ring-builder object.builder create 10 3 1
{% set region = 0 %}
{% set zone = 1 %}
{% set count = 0 %}
{% for host in groups['swift_hosts'] %}
{%   if count % 2 == 0 %}
{%     set region = region + 1 %}
{%   endif %}
swift-ring-builder object.builder add r{{ region }}z{{ zone }}-{{ hostvars[host]['ansible_eth0']['ipv4']['address'] }}:6010/swift1 1
swift-ring-builder object.builder add r{{ region }}z{{ zone }}-{{ hostvars[host]['ansible_eth0']['ipv4']['address'] }}:6010/swift2 1
{%   set zone = zone + 1 %}
{%   set count = count + 1 %}
{% endfor %}
swift-ring-builder object.builder rebalance
swift-ring-builder object-1.builder create 10 2 1
{% set region = 0 %}
{% set zone = 1 %}
{% set count = 0 %}
{% for host in groups['swift_hosts'] %}
{%   if count % 2 == 0 %}
{%     set region = region + 1 %}
{%   endif %}
swift-ring-builder object-1.builder add r{{ region }}z{{ zone }}-{{ hostvars[host]['ansible_eth0']['ipv4']['address'] }}:6010/swift1 1
swift-ring-builder object-1.builder add r{{ region }}z{{ zone }}-{{ hostvars[host]['ansible_eth0']['ipv4']['address'] }}:6010/swift2 1
{%   set zone = zone + 1 %}
{%   set count = count + 1 %}
{% endfor %}
swift-ring-builder object-1.builder rebalance
swift-ring-builder object-2.builder create 10 6 1
{% set region = 1 %}
{% set zone = 1 %}
{% for host in groups['swift_hosts'] %}
swift-ring-builder object-2.builder add r{{ region }}z{{ zone }}-{{ hostvars[host]['ansible_eth0']['ipv4']['address'] }}:6010/swift1 1
swift-ring-builder object-2.builder add r{{ region }}z{{ zone }}-{{ hostvars[host]['ansible_eth0']['ipv4']['address'] }}:6010/swift2 1
{%   set zone = zone + 1 %}
{% endfor %}
swift-ring-builder object-2.builder rebalance
swift-ring-builder container.builder create 10 3 1
{% set region = 0 %}
{% set zone = 1 %}
{% set count = 0 %}
{% for host in groups['swift_hosts'] %}
{%   if count % 2 == 0 %}
{%     set region = region + 1 %}
{%   endif %}
swift-ring-builder container.builder add r{{ region }}z{{ zone }}-{{ hostvars[host]['ansible_eth0']['ipv4']['address'] }}:6011/swift1 1
swift-ring-builder container.builder add r{{ region }}z{{ zone }}-{{ hostvars[host]['ansible_eth0']['ipv4']['address'] }}:6011/swift2 1
{%   set zone = zone + 1 %}
{%   set count = count + 1 %}
{% endfor %}
swift-ring-builder container.builder rebalance
swift-ring-builder account.builder create 10 3 1
{% set region = 0 %}
{% set zone = 1 %}
{% set count = 0 %}
{% for host in groups['swift_hosts'] %}
{%   if count % 2 == 0 %}
{%     set region = region + 1 %}
{%   endif %}
swift-ring-builder account.builder add r{{ region }}z{{ zone }}-{{ hostvars[host]['ansible_eth0']['ipv4']['address'] }}:6012/swift1 1
swift-ring-builder account.builder add r{{ region }}z{{ zone }}-{{ hostvars[host]['ansible_eth0']['ipv4']['address'] }}:6012/swift2 1
{%   set zone = zone + 1 %}
{%   set count = count + 1 %}
{% endfor %}
swift-ring-builder account.builder rebalance
